name: Build GiftWrap ZIP

on:
  push:
    branches: [main]
  release:
    types: [published]

jobs:
  giftwrap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Build ZIP
        run: |
          VERSION=$(date +'%Y.%m.%d.%H%M')
          mkdir -p dist
          zip -r dist/spidernet_secure_${VERSION}.zip . \
            -x ".git*" -x "dist/*" -x ".github/*"

      - name: Upload ZIP (Release)
        if: github.event_name == 'release'
        uses: softprops/action-gh-release@v1
        with:
          files: dist/*.zip
name: GiftWrap Sync

on:
  release:
    types: [published]
  push:
    paths:
      - "spidernet_secure_*.zip"

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Unpack ZIP
        run: |
          mkdir -p unpacked
          for zip in spidernet_secure_*.zip; do
            [ -f "$zip" ] || continue
            unzip -o "$zip" -d unpacked/
          done

      - name: Move files into repo
        run: |
          rsync -av unpacked/ ./ --exclude='.github/'

      - name: Commit and push
        run: |
          git config user.name "SpiderNet Bot"
          git config user.email "bot@spidernet"
          git add -A
          git commit -m "Auto-sync GiftWrap ZIP into repo" || echo "No changes"
          git push
name: 🌻 SpiderNet GiftWrap Auto-Sync (with ManualReader Check)

on:
  release:
    types: [published]
  push:
    paths:
      - "spidernet_secure_*.zip"

jobs:
  giftwrap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      # 🔎 Inspect ZIP first
      - name: Verify ManualReader presence
        run: |
          for z in spidernet_secure_*.zip; do
            if [ -f "$z" ]; then
              unzip -l "$z" | tee manifest.txt
              if ! grep -q "ManualReader.ps1" manifest.txt || ! grep -q "ManualReader.sh" manifest.txt; then
                echo "❌ ERROR: ManualReader missing in $z. GiftWrap aborted."
                exit 1
              fi
            fi
          done

      # 📥 Release ZIP download (if triggered by release)
      - name: Download release asset
        if: github.event_name == 'release'
        uses: dsaltares/fetch-gh-release-asset@master
        with:
          repo: ${{ github.repository }}
          version: latest
          file: spidernet_secure_v2.zip
          token: ${
name: 🌻 SpiderNet GiftWrap Auto-Sync

on:
  release:
    types: [published]      # Trigger when a Release is published
  push:
    paths:
      - "spidernet_secure_*.zip"   # Trigger when ZIP uploaded in repo root

jobs:
  giftwrap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      # 🔹 Case 1: Release ZIP
      - name: Download release asset
        if: github.event_name == 'release'
        uses: dsaltares/fetch-gh-release-asset@master
        with:
          repo: ${{ github.repository }}
          version: latest
          file: spidernet_secure_v2.zip
          token: ${{ secrets.GITHUB_TOKEN }}

      # 🔹 Case 2: Root ZIP (already pushed by user)
      - name: Extract root ZIPs
        if: github.event_name == 'push'
        run: |
          for z in spidernet_secure_*.zip; do
            if [ -f "$z" ]; then
              echo "📦 Extracting $z ..."
              unzip -o "$z" -d .
              rm "$z"
            fi
          done

      # 🔹 Common Commit & Push
      - name: Commit & Push
        run: |
          git config user.name "spidernet-bot"
          git config user.email "bot@sattvamusk.com"
          git add .
          git commit -m "🌻 GiftWrap Auto-Sync from ZIP" || echo "No changes to commit"
          git push origin main
name: 🌻 Root ZIP Auto-Sync

on:
  push:
    paths:
      - "spidernet_secure_*.zip"   # any ZIP dropped in repo root

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
name: 🌻 Release Auto-Sync

on:
  release:
    types: [published]   # triggers whenever you publish a release

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Download release asset
        uses: dsaltares/fetch-gh-release-asset@master
        with:
          repo: ${{ github.repository }}
          version: latest
          file: spidernet_secure_v2.zip
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract and sync
        run: |
          unzip -o spidernet_secure_v2.zip -d .
          rm spidernet_secure_v2.zip
          git config user.name "spidernet-bot"
          git config user.email "bot@sattvamusk.com"
          git add .
          git commit -m "🌻 Auto-sync from Release ZIP" || echo "No changes to commit"
          git push origin main
Auto-Sync from Release ZIP
