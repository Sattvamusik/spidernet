name: ğŸš€ SpiderNet GiftWrap Builder

on:
  push:
    branches: [ main ]
    paths:
      - "agents/**"
      - "assets/**"
      - "install.sh"
      - "install.ps1"
      - "cockpit.py"
      - "PROJECTS.md"
      - "IDEAS.md"
  workflow_dispatch:
  release:
    types: [created]

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      # 1. Checkout repo
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      # 2. Set up Python (for preflight tests)
      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      # 3. Install test deps
      - name: ğŸ“¦ Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pyqt5 pillow

      # 4. Run quick syntax check (no broken scripts)
      - name: âœ… Preflight test
        run: |
          python -m py_compile cockpit.py || exit 1
          echo "Preflight âœ…"

      # 5. Build ZIP package
      - name: ğŸ Build GiftWrap ZIP
        run: |
          mkdir -p build
          zip -r build/spidernet_secure.zip \
            agents/ assets/ cockpit.py \
            install.sh install.ps1 \
            PROJECTS.md IDEAS.md README.md

      # 6. Upload ZIP to release (if release triggered)
      - name: ğŸš€ Upload release asset
        if: github.event_name == 'release'
        uses: softprops/action-gh-release@v2
        with:
          files: build/spidernet_secure.zip

      # 7. Upload artifact (always available in Actions tab)
      - name: ğŸ“¤ Upload artifact (CI only)
        uses: actions/upload-artifact@v4
        with:
          name: spidernet_secure
          path: build/spidernet_secure.zip
name: Build GiftWrap ZIP

on:
  push:
    branches: [ main ]
  release:
    types: [ published ]

jobs:
  giftwrap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Build ZIP
        run: |
          VERSION=${GITHUB_REF##*/}
          mkdir -p dist
          zip -r dist/spidernet_secure_${VERSION}.zip . \
            -x ".git*" -x "dist/*" -x ".github/*"

      - name: Upload ZIP (Release)
        if: github.event_name == 'release'
        uses: softprops/action-gh-release@v1
        with:
          files: dist/*.zip
name: Build GiftWrap ZIP

on:
  push:
    branches: [main]
  release:
    types: [published]

jobs:
  giftwrap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3

      - name: Build ZIP
        run: |
          VERSION=$(date +'%Y.%m.%d.%H%M')
          mkdir -p dist
          zip -r dist/spidernet_secure_${VERSION}.zip . \
            -x ".git*" -x "dist/*" -x ".github/*"

      - name: Upload ZIP (Release)
        if: github.event_name == 'release'
        uses: softprops/action-gh-release@v1
        with:
          files: dist/*.zip
name: GiftWrap Sync

on:
  release:
    types: [published]
  push:
    paths:
      - "spidernet_secure_*.zip"

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v3
        with:
          fetch-depth: 0

      - name: Unpack ZIP
        run: |
          mkdir -p unpacked
          for zip in spidernet_secure_*.zip; do
            [ -f "$zip" ] || continue
            unzip -o "$zip" -d unpacked/
          done

      - name: Move files into repo
        run: |
          rsync -av unpacked/ ./ --exclude='.github/'

      - name: Commit and push
        run: |
          git config user.name "SpiderNet Bot"
          git config user.email "bot@spidernet"
          git add -A
          git commit -m "Auto-sync GiftWrap ZIP into repo" || echo "No changes"
          git push
name: ğŸŒ» SpiderNet GiftWrap Auto-Sync (with ManualReader Check)

on:
  release:
    types: [published]
  push:
    paths:
      - "spidernet_secure_*.zip"

jobs:
  giftwrap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      # ğŸ” Inspect ZIP first
      - name: Verify ManualReader presence
        run: |
          for z in spidernet_secure_*.zip; do
            if [ -f "$z" ]; then
              unzip -l "$z" | tee manifest.txt
              if ! grep -q "ManualReader.ps1" manifest.txt || ! grep -q "ManualReader.sh" manifest.txt; then
                echo "âŒ ERROR: ManualReader missing in $z. GiftWrap aborted."
                exit 1
              fi
            fi
          done

      # ğŸ“¥ Release ZIP download (if triggered by release)
      - name: Download release asset
        if: github.event_name == 'release'
        uses: dsaltares/fetch-gh-release-asset@master
        with:
          repo: ${{ github.repository }}
          version: latest
          file: spidernet_secure_v2.zip
          token: ${
name: ğŸŒ» SpiderNet GiftWrap Auto-Sync

on:
  release:
    types: [published]      # Trigger when a Release is published
  push:
    paths:
      - "spidernet_secure_*.zip"   # Trigger when ZIP uploaded in repo root

jobs:
  giftwrap:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      # ğŸ”¹ Case 1: Release ZIP
      - name: Download release asset
        if: github.event_name == 'release'
        uses: dsaltares/fetch-gh-release-asset@master
        with:
          repo: ${{ github.repository }}
          version: latest
          file: spidernet_secure_v2.zip
          token: ${{ secrets.GITHUB_TOKEN }}

      # ğŸ”¹ Case 2: Root ZIP (already pushed by user)
      - name: Extract root ZIPs
        if: github.event_name == 'push'
        run: |
          for z in spidernet_secure_*.zip; do
            if [ -f "$z" ]; then
              echo "ğŸ“¦ Extracting $z ..."
              unzip -o "$z" -d .
              rm "$z"
            fi
          done

      # ğŸ”¹ Common Commit & Push
      - name: Commit & Push
        run: |
          git config user.name "spidernet-bot"
          git config user.email "bot@sattvamusk.com"
          git add .
          git commit -m "ğŸŒ» GiftWrap Auto-Sync from ZIP" || echo "No changes to commit"
          git push origin main
name: ğŸŒ» Root ZIP Auto-Sync

on:
  push:
    paths:
      - "spidernet_secure_*.zip"   # any ZIP dropped in repo root

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4
name: ğŸŒ» Release Auto-Sync

on:
  release:
    types: [published]   # triggers whenever you publish a release

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Download release asset
        uses: dsaltares/fetch-gh-release-asset@master
        with:
          repo: ${{ github.repository }}
          version: latest
          file: spidernet_secure_v2.zip
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Extract and sync
        run: |
          unzip -o spidernet_secure_v2.zip -d .
          rm spidernet_secure_v2.zip
          git config user.name "spidernet-bot"
          git config user.email "bot@sattvamusk.com"
          git add .
          git commit -m "ğŸŒ» Auto-sync from Release ZIP" || echo "No changes to commit"
          git push origin main
Auto-Sync from Release ZIP

